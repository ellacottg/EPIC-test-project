I've decided (shortly after starting) to port this to assembly for better control
